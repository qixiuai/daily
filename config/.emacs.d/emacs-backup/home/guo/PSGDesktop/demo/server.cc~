
#include "server.h"

#include <memory>

DemoServer::DemoServer(utility::string_t url): m_listener(url) {
  m_listener.support(methods::GET, std::bind(&DemoServer::handle_get, this, std::placeholders::_1));
}

void DemoServer::handle_get(http_request message) {
  ucout << message.to_string() << '\n';
  return;
}

DemoServer::~DemoServer() {
  m_listener.close();
}

int main() {
  utility::string_t addr = U("http://localhost::8000");
   
   std::unique_ptr<DemoServer> http_handler =
     std::unique_ptr<DemoServer>(new DemoServer(addr));
   http_handler->open().wait();
   ucout << "Listening for request at: " << addr << '\n';
   
  return 0;
}
