
import untangle
import ecgpeaks

def load_subject(xml_path):
    obj = untangle.parse(xml_path)
    components = obj.AnnotatedECG.component.series.component.sequenceSet.component
    dataset = {}
    for component in components[1:]:
        signal_name = component.sequence.code["code"]
        signal_value_strs = component.sequence.value.digits.cdata.strip().split(' ')
        signal_value = list(map(int, signal_value_strs))
        dataset[signal_name] = signal_value
    return dataset


class MedexsDataset(object):

    def __init__(self):
        self._data_dir = "/home/guo/physio/medexs/"
        self._files = glob(self._data_dir + "*.xml")
        
    def generate_data(self):
        pass

    def __call__(self):
        for xml in self._files:
            signal = load_subject(xml)
            yield signal


def main(argv):
    del argv
    dataset = load_subject("/home/guo/physio/medexs/1102211801010831285157606_陈惠文.xml")
    signal = dataset["MDC_ECG_LEAD_I"]
    for val in signal:
        ecgpeaks.findpeaks_in_ecg(val)
    print("print index of peaks")

