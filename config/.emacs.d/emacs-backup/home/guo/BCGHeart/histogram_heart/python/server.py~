
from flask import Flask, request
from flask_restful import Api, Resource, reqparse

import requests

import pdb

from heart_rate_inference import HeartRateInference

app = Flask(__name__)
api = Api(app)


class HeartRateInferenceHub(object):

    def __init__(self):
        self.hub = {}

    def filter(self, id, interval):
        if id not in self.hub:
            self.hub[id] = HeartRateInference()
        interval = self.hub[id].inference(interval)
        return interval


class HeartInferenceServer(Resource):

    hub = HeartRateInferenceHub()

    def post(self):
        param = request.json
        id = param['sn']
        interval = param['interval']
        if isinstance(interval, str):
            interval = int(interval)
        interval = self.hub.filter(id, interval)
        interval = str(interval)
        param["interval"] = interval
        return param

    def get(self):
        return "get demo for test usage"

api.add_resource(HeartInferenceServer, "/")


if __name__ == '__main__':
    app.run('127.0.0.1', port=8001)

