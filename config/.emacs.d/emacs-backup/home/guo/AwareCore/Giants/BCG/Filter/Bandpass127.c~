
#include <stdio.h>

// For Fz = 500Hz 

void filter(float* y, float *x, int n, float* b, int nb, float* a, int na);

void Bandpass127(float*y, float*x, int n) {
  // Fstop1 Fpass1 Fpass2 Fstop2 = [95 115 135 145]
  // Den is a;
  float Den[] = {1,                1.24900090270330e-16, 11.6385787124517, 1.28455937582606e-15,
		 63.0618077916339, 6.66597342423672e-15, 210.821477607258, 2.12750363375047e-14,
		 485.767954178377, 4.93749141806260e-14, 816.006452573699, 8.39660794590464e-14,
		 1030.47212897693, 1.03792776693774e-13, 993.715138948934, 9.52787245335729e-14,
		 735.281768153924, 6.16795910493515e-14, 415.399800146075, 2.78111872848438e-14,
		 176.372753573856, 9.60706932604795e-15, 54.5705898051064, 2.22286679710580e-15,
		 11.6304842271506, 3.05610089417023e-16, 1.52826576891559, 1.91859458350762e-17,
		 0.0934066632755592};
  // Num is b;
  float Num[] = {1.65381102088747e-13, 0, -2.31533542924246e-12, 0,
		 1.50496802900760e-11, 0, -6.01987211603041e-11, 0,
		 1.65546483190836e-10, 0, -3.31092966381672e-10, 0,
		 4.96639449572509e-10, 0, -5.67587942368581e-10, 0,
		 4.96639449572509e-10, 0, -3.31092966381672e-10, 0,
		 1.65546483190836e-10, 0, -6.01987211603041e-11, 0,
		 1.50496802900760e-11, 0, -2.31533542924246e-12, 0,
		 1.65381102088747e-13};
  
  filter(y, x, n, Num, 29, Den, 29);
}


void filter(float* y, float *x, int n, float* b, int nb, float* a, int na) {
  float upper, lower;
  upper = lower = 0;
  for (int i=0; n-i>=0 && i<nb; i++) {
    upper += b[i]*x[n-i];
  }
  for (int i=1; n-i>=0 && i<na; i++) {
    lower += a[i]*y[n-i];
  }
  y[n] = upper - lower;
}

int main() {

  float x[] = {1,2,3,4,5,6,7,8,9,10,11,12,13,14};
  float y[14];
  for (int i = 0; i < 14; i++) {
    Bandpass127(y, x, i);
  }
  for (int i = 0; i < 14; i++) {
    printf("%f\t", y[i]);
  }
}
