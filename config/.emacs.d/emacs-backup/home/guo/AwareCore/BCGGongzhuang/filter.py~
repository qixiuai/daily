import os
import numpy as np
from glob import glob
from scipy.signal import lfilter
import pdb

def lowpass(signal):
    a = np.loadtxt('coeffs/lowpass_a.csv', delimiter=',')
    b = np.loadtxt('coeffs/lowpass_b.csv', delimiter=',')
    pdb.set_trace()
    return lfilter(b, a, signal)

def load_data(file_path):
    data = np.loadtxt(file_path)
    return data

def save_data(out_path, signal):
    with open(out_path, 'w') as out:
        for val in signal:
            out.write(str(val)+'\n')

def main(data_dir):
    for filename in os.listdir(data_dir):
        if filename[:13] != "parsed_heart[":
            continue
        file_path   = os.path.join(data_dir, filename)
        signal      = load_data(file_path)
        signal_filt = lowpass(signal)
        out_path    = data_dir + 'lowpass_' + filename
        save_data(out_path, signal_filt)

if __name__ == '__main__':
    data_dir = 'data/'
    main(data_dir)

        

