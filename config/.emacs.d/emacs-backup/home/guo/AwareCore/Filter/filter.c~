#include "filter.h"

void filter(double* y, double *x, int len, \
	    double* b, int nb,	\
	    double* a, int na );

// lowpass: Fpass20Hz, Fstop30Hz, order=30
void fir_lowpass_500(double* y, double *x, int len) {
  double b[] = {-0.0718, -0.0153, -0.0140, -0.0104, -0.0045, \
		0.0038, 0.0141, 0.0261, 0.0393, 0.0529, 0.0662, \
		0.0784, 0.0889, 0.0968, 0.1018, 0.1035, 0.1018, \
		0.0968, 0.0889, 0.0784, 0.0662, 0.0529, 0.0393, \
		0.0261, 0.0141, 0.0038, -0.0045, -0.0104, \
		-0.0140, -0.0153, -0.0718};
  double a[] = {1};
  int nb=31, na=1;
  for (int n=0; n<len; n++) 
    filter(y, x, n, b, nb, a, na);
}

void fir_lowpass_online_500(double* y, double *x, int n) {
  double b[] = {-0.0718, -0.0153, -0.0140, -0.0104, -0.0045, \
		0.0038, 0.0141, 0.0261, 0.0393, 0.0529, 0.0662, \
		0.0784, 0.0889, 0.0968, 0.1018, 0.1035, 0.1018, \
		0.0968, 0.0889, 0.0784, 0.0662, 0.0529, 0.0393, \
		0.0261, 0.0141, 0.0038, -0.0045, -0.0104, \
		-0.0140, -0.0153, -0.0718};
  double a[] = {1};
  int nb=31, na=1;
  filter(y, x, n, b, nb, a, na);
}

// highpass: Fstop:0.1Hz, Fpass: 0.2Hz Least-Square, order=30
// realtime len=31
void fir_highpass_500(double* y, double *x, int len) {
  double b[] = {-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004, 0.9996,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004};
  int nb  = 31;
  double a[] = {1};
  int na  = 1;
  for (int n=0; n<len; n++)
    filter(y, x, n, b, nb, a, na);
}

// 
void fir_highpass_online_500(double* y, double *x, int n) {
  double b[] = {-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004, 0.9996,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004,-0.0004};
  int nb  = 31;
  double a[] = {1};
  int na  = 1;
  filter(y, x, n, b, nb, a, na);
}

void filter(double* y, double *x, int n, double* b, int nb, double* a, int na) {
  double upper, lower;
  upper = lower = 0;
  for (int i=0; n-i>=0 && i<nb; i++) {
    upper += b[i]*x[n-i];
  }
  for (int i=1; n-i>=0 && i<na; i++) {
    lower += a[i]*y[n-i];
  }
  y[n] = upper - lower;
}


/*
int main() {
  double b[] = {1, 2, 5};
  double a[] = {1,3,3};
  double x[] = {1, 2, 3.0, 4.0, 5.0};
  double y[5];
  //  fir_lowpass_500(x, y, 3);
  for (int i=0; i<5; i++) {
    filter(y, x, i, b, 3, a, 3);
    printf("%f\t", y[i]);
  }
  
  double xx[] = {1, 2, 3.0};
  double yy[3];
  //fir_lowpass_online_500(x, y, 3);
  
  
  return 0;
}
*/
