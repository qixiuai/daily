
import os
import shutil

import tensorflow as tf

import pdb

export_dir = "/home/guo/AwareCore/PSGFramework/sleepstage/saved_model/"

def make_graph():
    a = tf.get_variable("a", shape=[3,], initializer=tf.zeros_initializer)
    b = tf.get_variable("b", shape=[3,], initializer=tf.zeros_initializer)
    c = a + b    
    init_op = tf.global_variables_initializer()
    saver = tf.train.Saver()

    with tf.Session() as sess:
        sess.run(init_op)
        print(sess.run(c))
        return
        tf.saved_model.simple_save(sess,
                                   export_dir,
                                   inputs={"a":a, "b":b},
                                   outputs={"c": c})


def run_example():
    if os.path.exists(export_dir):
        shutil.rmtree(export_dir)
    run_example()
    a = tf.placeholder(tf.float32, name="example")
    c = a + 1
    init_op = tf.global_variables_initializer()
    with tf.Session() as sess:
        sess.run(init_op)
        print(sess.run(c, feed_dict={"example:0":[1,2,3,45]}))
        tf.saved_model.simple_save(sess,
                                   export_dir,
                                   inputs={"example":a},
                                   outputs={"result": c})
        
def load_graph():
    with tf.Session(graph=tf.Graph()) as sess:
        tf.saved_model.loader.load(sess, [tf.saved_model.tag_constants.SERVING], export_dir)
        print("load graph result: {}".format(sess.run('result:0', feed_dict={"example:0":[1,1,1]})))

if __name__ == "__main__":
#    make_graph()
    load_graph()

